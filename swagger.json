{
  "openapi": "3.0.0",
  "info": {
    "title": "KEA DHCP API Admin",
    "version": "2.0.0",
    "description": "Comprehensive API for managing KEA DHCP server, CIN switches, BVI interfaces, subnets, and network resources."
  },
  "servers": [
    {
      "url": "/api",
      "description": "API Server"
    }
  ],
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "API Key authentication. Supports read-only and read/write keys."
      },
      "SessionAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "PHPSESSID",
        "description": "Session-based authentication for web UI access."
      }
    }
  },
  "security": [
    {
      "ApiKeyAuth": []
    },
    {
      "SessionAuth": []
    }
  ],
  "tags": [
    {"name": "API Keys", "description": "Manage API keys for authentication"},
    {"name": "Users", "description": "User management and authentication"},
    {"name": "Dashboard", "description": "System statistics and status"},
    {"name": "CIN Switches", "description": "CIN switch management"},
    {"name": "BVI Interfaces", "description": "BVI interface configuration"},
    {"name": "DHCP Subnets", "description": "DHCPv6 subnet management"},
    {"name": "DHCPv6 Options Definitions", "description": "DHCPv6 custom option definitions"},
    {"name": "DHCPv6 Options", "description": "DHCPv6 option configuration"},
    {"name": "DHCPv6 Leases", "description": "Lease and reservation management"},
    {"name": "IPv6 Subnets", "description": "IPv6 subnet management (Kea)"},
    {"name": "RADIUS (802.1X)", "description": "RADIUS client and server management for 802.1X authentication"}
  ],
  "paths": {
    "/keys": {
      "get": {"summary": "List API keys", "tags": ["API Keys"]},
      "post": {"summary": "Create API key", "tags": ["API Keys"]}
    },
    "/keys/{id}/deactivate": {
      "post": {"summary": "Deactivate API key", "tags": ["API Keys"]}
    },
    "/keys/{id}": {
      "delete": {"summary": "Delete API key", "tags": ["API Keys"]}
    },
    "/users": {
      "get": {"summary": "List users", "tags": ["Users"]},
      "post": {"summary": "Create user", "tags": ["Users"]}
    },
    "/users/{id}": {
      "get": {"summary": "Get user", "tags": ["Users"]},
      "put": {"summary": "Update user", "tags": ["Users"]},
      "delete": {"summary": "Delete user", "tags": ["Users"]}
    },
    "/users/check-username/{username}": {
      "get": {"summary": "Check username availability", "tags": ["Users"]}
    },
    "/users/check-email/{email}": {
      "get": {"summary": "Check email availability", "tags": ["Users"]}
    },
    "/dashboard/stats": {
      "get": {"summary": "Get system statistics", "tags": ["Dashboard"]}
    },
    "/dashboard/kea-status": {
      "get": {"summary": "Get Kea DHCP status", "tags": ["Dashboard"]}
    },
    "/switches": {
      "get": {"summary": "List switches", "tags": ["CIN Switches"]},
      "post": {"summary": "Create switch", "tags": ["CIN Switches"]}
    },
    "/switches/{id}": {
      "get": {"summary": "Get switch", "tags": ["CIN Switches"]},
      "put": {"summary": "Update switch", "tags": ["CIN Switches"]},
      "delete": {"summary": "Delete switch", "tags": ["CIN Switches"]}
    },
    "/switches/check-exists": {
      "get": {"summary": "Check hostname exists", "tags": ["CIN Switches"]}
    },
    "/switches/check-bvi": {
      "get": {"summary": "Validate BVI", "tags": ["CIN Switches"]}
    },
    "/switches/check-ipv6": {
      "get": {"summary": "Validate IPv6", "tags": ["CIN Switches"]}
    },
    "/switches/{switchId}/bvi": {
      "get": {"summary": "List BVI interfaces", "tags": ["BVI Interfaces"]},
      "post": {"summary": "Create BVI", "tags": ["BVI Interfaces"]}
    },
    "/switches/{switchId}/bvi/{bviId}": {
      "get": {"summary": "Get BVI", "tags": ["BVI Interfaces"]},
      "put": {"summary": "Update BVI", "tags": ["BVI Interfaces"]},
      "delete": {"summary": "Delete BVI", "tags": ["BVI Interfaces"]}
    },
    "/switches/{switchId}/bvi/check-exists": {
      "get": {"summary": "Check BVI exists", "tags": ["BVI Interfaces"]}
    },
    "/switches/bvi/check-ipv6": {
      "get": {"summary": "Check IPv6 exists", "tags": ["BVI Interfaces"]}
    },
    "/dhcp/subnets": {
      "get": {"summary": "List DHCP subnets", "tags": ["DHCP Subnets"]},
      "post": {"summary": "Create subnet", "tags": ["DHCP Subnets"]}
    },
    "/dhcp/subnets/check-duplicate": {
      "post": {"summary": "Check duplicate subnet", "tags": ["DHCP Subnets"]}
    },
    "/dhcp/subnets/{id}": {
      "put": {"summary": "Update subnet", "tags": ["DHCP Subnets"]},
      "delete": {"summary": "Delete subnet", "tags": ["DHCP Subnets"]}
    },
    "/dhcp/orphaned-subnets/{keaId}": {
      "delete": {"summary": "Delete orphaned subnet", "tags": ["DHCP Subnets"]}
    },
    "/dhcp/link-orphaned-subnet": {
      "post": {"summary": "Link orphaned subnet to BVI", "tags": ["DHCP Subnets"], "description": "Link an existing orphaned Kea subnet to a BVI interface"}
    },
    "/dhcp/create-cin-and-link": {
      "post": {"summary": "Create CIN and link subnet", "tags": ["DHCP Subnets"], "description": "Create new CIN switch, BVI interface, and link to orphaned subnet"}
    },
    "/dhcp/optionsdef": {
      "get": {"summary": "List option definitions", "tags": ["DHCPv6 Options Definitions"]},
      "post": {"summary": "Create option definition", "tags": ["DHCPv6 Options Definitions"]}
    },
    "/dhcp/optionsdef/{code}": {
      "put": {"summary": "Update option definition", "tags": ["DHCPv6 Options Definitions"]},
      "delete": {"summary": "Delete option definition", "tags": ["DHCPv6 Options Definitions"]}
    },
    "/dhcp/options": {
      "get": {"summary": "List options", "tags": ["DHCPv6 Options"]},
      "post": {"summary": "Create option", "tags": ["DHCPv6 Options"]}
    },
    "/dhcp/options/{code}": {
      "put": {"summary": "Update option", "tags": ["DHCPv6 Options"]},
      "delete": {"summary": "Delete option", "tags": ["DHCPv6 Options"]}
    },
    "/dhcp/leases/{switchId}/{bviId}/{from}/{limit}": {
      "get": {"summary": "Get leases (paginated)", "tags": ["DHCPv6 Leases"], "description": "Retrieve DHCPv6 leases with pagination. Use 'start' for first page or an IPv6 address to continue from."}
    },
    "/dhcp/leases": {
      "delete": {"summary": "Delete lease", "tags": ["DHCPv6 Leases"]}
    },
    "/dhcp/static": {
      "post": {"summary": "Add static lease/reservation", "tags": ["DHCPv6 Leases"]}
    },
    "/dhcp/static/{subnetId}": {
      "get": {"summary": "Get static leases", "tags": ["DHCPv6 Leases"]}
    },
    "/dhcp/search-leases": {
      "get": {
        "summary": "Advanced lease search",
        "description": "Search DHCPv6 leases with multiple filter criteria including IPv6 address, DUID, hostname, switch/BVI, subnet, lease type, state, and date range. Supports pagination and CSV export.",
        "tags": ["DHCPv6 Leases"],
        "parameters": [
          {"name": "ipv6_address", "in": "query", "schema": {"type": "string"}, "description": "Filter by IPv6 address (partial match)"},
          {"name": "duid", "in": "query", "schema": {"type": "string"}, "description": "Filter by DUID/MAC address"},
          {"name": "hostname", "in": "query", "schema": {"type": "string"}, "description": "Filter by hostname (partial match)"},
          {"name": "switch_id", "in": "query", "schema": {"type": "integer"}, "description": "Filter by switch ID"},
          {"name": "bvi_id", "in": "query", "schema": {"type": "integer"}, "description": "Filter by BVI interface ID"},
          {"name": "subnet_id", "in": "query", "schema": {"type": "integer"}, "description": "Filter by subnet ID"},
          {"name": "lease_type", "in": "query", "schema": {"type": "integer", "enum": [0, 2]}, "description": "Lease type: 0=IA_NA, 2=IA_PD"},
          {"name": "state", "in": "query", "schema": {"type": "integer", "enum": [0, 1, 2]}, "description": "Lease state: 0=Active, 1=Declined, 2=Expired"},
          {"name": "date_from", "in": "query", "schema": {"type": "string", "format": "date-time"}, "description": "Filter by valid from date"},
          {"name": "date_to", "in": "query", "schema": {"type": "string", "format": "date-time"}, "description": "Filter by valid until date"},
          {"name": "page", "in": "query", "schema": {"type": "integer", "default": 1}, "description": "Page number for pagination"},
          {"name": "page_size", "in": "query", "schema": {"type": "integer", "default": 50, "maximum": 500}, "description": "Results per page"},
          {"name": "export", "in": "query", "schema": {"type": "string", "enum": ["csv"]}, "description": "Export results to CSV format"}
        ],
        "responses": {
          "200": {
            "description": "Search results returned successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {"type": "boolean"},
                    "data": {"type": "array", "items": {"type": "object"}},
                    "total": {"type": "integer"},
                    "page": {"type": "integer"},
                    "page_size": {"type": "integer"},
                    "total_pages": {"type": "integer"}
                  }
                }
              }
            }
          }
        }
      }
    },
    "/ipv6/subnets": {
      "get": {"summary": "List IPv6 subnets", "tags": ["IPv6 Subnets"]},
      "post": {"summary": "Create IPv6 subnet", "tags": ["IPv6 Subnets"]}
    },
    "/ipv6/subnets/{subnetId}": {
      "get": {"summary": "Get IPv6 subnet", "tags": ["IPv6 Subnets"]},
      "put": {"summary": "Update IPv6 subnet", "tags": ["IPv6 Subnets"]},
      "delete": {"summary": "Delete IPv6 subnet", "tags": ["IPv6 Subnets"]}
    },
    "/ipv6/bvi/{bviId}/subnets": {
      "get": {"summary": "Get subnets by BVI", "tags": ["IPv6 Subnets"]}
    },
    "/radius/clients": {
      "get": {"summary": "List all RADIUS clients", "tags": ["RADIUS (802.1X)"], "description": "Get all RADIUS clients configured for 802.1X authentication"},
      "post": {"summary": "Create RADIUS client", "tags": ["RADIUS (802.1X)"], "description": "Create a new RADIUS client (NAS)"}
    },
    "/radius/clients/{id}": {
      "get": {"summary": "Get RADIUS client", "tags": ["RADIUS (802.1X)"]},
      "put": {"summary": "Update RADIUS client", "tags": ["RADIUS (802.1X)"], "description": "Update RADIUS client secret and details"},
      "delete": {"summary": "Delete RADIUS client", "tags": ["RADIUS (802.1X)"]}
    },
    "/radius/global-secret": {
      "get": {"summary": "Get global secret status", "tags": ["RADIUS (802.1X)"], "description": "Check if global shared secret is configured"},
      "put": {"summary": "Set global secret", "tags": ["RADIUS (802.1X)"], "description": "Configure global shared secret for all RADIUS clients"}
    },
    "/radius/sync": {
      "post": {"summary": "Sync BVI interfaces", "tags": ["RADIUS (802.1X)"], "description": "Synchronize BVI interfaces to RADIUS clients"}
    },
    "/radius/servers/status": {
      "get": {"summary": "Get FreeRADIUS servers status", "tags": ["RADIUS (802.1X)"], "description": "Health check for all configured FreeRADIUS database servers"}
    },
    "/radius/servers/sync": {
      "post": {"summary": "Force sync to servers", "tags": ["RADIUS (802.1X)"], "description": "Force sync all RADIUS clients to all FreeRADIUS databases"}
    },
    "/radius/servers/config": {
      "get": {"summary": "Get RADIUS server configs", "tags": ["RADIUS (802.1X)"], "description": "Get all FreeRADIUS server database configurations (Admin only)"},
      "put": {"summary": "Update server config", "tags": ["RADIUS (802.1X)"], "description": "Update FreeRADIUS server database configuration (Admin only)"}
    },
    "/radius/servers/test": {
      "post": {"summary": "Test server connection", "tags": ["RADIUS (802.1X)"], "description": "Test connection to FreeRADIUS database server (Admin only)"}
    }
  }
}
